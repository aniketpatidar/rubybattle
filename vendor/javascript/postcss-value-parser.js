import e from"./unit.js";var r={};var n="(".charCodeAt(0);var a=")".charCodeAt(0);var t="'".charCodeAt(0);var o='"'.charCodeAt(0);var s="\\".charCodeAt(0);var d="/".charCodeAt(0);var u=",".charCodeAt(0);var c=":".charCodeAt(0);var l="*".charCodeAt(0);var i="u".charCodeAt(0);var f="U".charCodeAt(0);var h="+".charCodeAt(0);var v=/^[a-f0-9?-]+$/i;r=function(e){var r=[];var p=e;var A,y,g,x,C,I,w,E;var P=0;var V=p.charCodeAt(P);var b=p.length;var m=[{nodes:r}];var k=0;var $;var N="";var O="";var q="";while(P<b)if(V<=32){A=P;do{A+=1;V=p.charCodeAt(A)}while(V<=32);x=p.slice(P,A);g=r[r.length-1];if(V===a&&k)q=x;else if(g&&"div"===g.type){g.after=x;g.sourceEndIndex+=x.length}else V===u||V===c||V===d&&p.charCodeAt(A+1)!==l&&(!$||$&&"function"===$.type&&"calc"!==$.value)?O=x:r.push({type:"space",sourceIndex:P,sourceEndIndex:A,value:x});P=A}else if(V===t||V===o){A=P;y=V===t?"'":'"';x={type:"string",sourceIndex:P,quote:y};do{C=false;A=p.indexOf(y,A+1);if(~A){I=A;while(p.charCodeAt(I-1)===s){I-=1;C=!C}}else{p+=y;A=p.length-1;x.unclosed=true}}while(C);x.value=p.slice(P+1,A);x.sourceEndIndex=x.unclosed?A:A+1;r.push(x);P=A+1;V=p.charCodeAt(P)}else if(V===d&&p.charCodeAt(P+1)===l){A=p.indexOf("*/",P);x={type:"comment",sourceIndex:P,sourceEndIndex:A+2};if(-1===A){x.unclosed=true;A=p.length;x.sourceEndIndex=A}x.value=p.slice(P+2,A);r.push(x);P=A+2;V=p.charCodeAt(P)}else if(V!==d&&V!==l||!$||"function"!==$.type||"calc"!==$.value)if(V===d||V===u||V===c){x=p[P];r.push({type:"div",sourceIndex:P-O.length,sourceEndIndex:P+x.length,value:x,before:O,after:""});O="";P+=1;V=p.charCodeAt(P)}else if(n===V){A=P;do{A+=1;V=p.charCodeAt(A)}while(V<=32);E=P;x={type:"function",sourceIndex:P-N.length,value:N,before:p.slice(E+1,A)};P=A;if("url"===N&&V!==t&&V!==o){A-=1;do{C=false;A=p.indexOf(")",A+1);if(~A){I=A;while(p.charCodeAt(I-1)===s){I-=1;C=!C}}else{p+=")";A=p.length-1;x.unclosed=true}}while(C);w=A;do{w-=1;V=p.charCodeAt(w)}while(V<=32);if(E<w){x.nodes=P!==w+1?[{type:"word",sourceIndex:P,sourceEndIndex:w+1,value:p.slice(P,w+1)}]:[];if(x.unclosed&&w+1!==A){x.after="";x.nodes.push({type:"space",sourceIndex:w+1,sourceEndIndex:A,value:p.slice(w+1,A)})}else{x.after=p.slice(w+1,A);x.sourceEndIndex=A}}else{x.after="";x.nodes=[]}P=A+1;x.sourceEndIndex=x.unclosed?A:P;V=p.charCodeAt(P);r.push(x)}else{k+=1;x.after="";x.sourceEndIndex=P+1;r.push(x);m.push(x);r=x.nodes=[];$=x}N=""}else if(a===V&&k){P+=1;V=p.charCodeAt(P);$.after=q;$.sourceEndIndex+=q.length;q="";k-=1;m[m.length-1].sourceEndIndex=P;m.pop();$=m[k];r=$.nodes}else{A=P;do{V===s&&(A+=1);A+=1;V=p.charCodeAt(A)}while(A<b&&!(V<=32||V===t||V===o||V===u||V===c||V===d||V===n||V===l&&$&&"function"===$.type&&"calc"===$.value||V===d&&"function"===$.type&&"calc"===$.value||V===a&&k));x=p.slice(P,A);n===V?N=x:i!==x.charCodeAt(0)&&f!==x.charCodeAt(0)||h!==x.charCodeAt(1)||!v.test(x.slice(2))?r.push({type:"word",sourceIndex:P,sourceEndIndex:A,value:x}):r.push({type:"unicode-range",sourceIndex:P,sourceEndIndex:A,value:x});P=A}else{x=p[P];r.push({type:"word",sourceIndex:P-O.length,sourceEndIndex:P+x.length,value:x});P+=1;V=p.charCodeAt(P)}for(P=m.length-1;P;P-=1){m[P].unclosed=true;m[P].sourceEndIndex=p.length}return m[0].nodes};var p=r;var A={};A=function walk(e,r,n){var a,t,o,s;for(a=0,t=e.length;a<t;a+=1){o=e[a];n||(s=r(o,a,e));false!==s&&"function"===o.type&&Array.isArray(o.nodes)&&walk(o.nodes,r,n);n&&r(o,a,e)}};var y=A;var g={};function stringifyNode(e,r){var n=e.type;var a=e.value;var t;var o;if(r&&void 0!==(o=r(e)))return o;if("word"===n||"space"===n)return a;if("string"===n){t=e.quote||"";return t+a+(e.unclosed?"":t)}if("comment"===n)return"/*"+a+(e.unclosed?"":"*/");if("div"===n)return(e.before||"")+a+(e.after||"");if(Array.isArray(e.nodes)){t=stringify$1(e.nodes,r);return"function"!==n?t:a+"("+(e.before||"")+t+(e.after||"")+(e.unclosed?"":")")}return a}function stringify$1(e,r){var n,a;if(Array.isArray(e)){n="";for(a=e.length-1;~a;a-=1)n=stringifyNode(e[a],r)+n;return n}return stringifyNode(e,r)}g=stringify$1;var x=g;var C="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var I={};var w=p;var E=y;var P=x;function ValueParser(e){if((this||C)instanceof ValueParser){(this||C).nodes=w(e);return this||C}return new ValueParser(e)}ValueParser.prototype.toString=function(){return Array.isArray((this||C).nodes)?P((this||C).nodes):""};ValueParser.prototype.walk=function(e,r){E((this||C).nodes,e,r);return this||C};ValueParser.unit=e;ValueParser.walk=E;ValueParser.stringify=P;I=ValueParser;var V=I;export{V as default};

